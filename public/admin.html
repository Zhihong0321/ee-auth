<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Atap.solar</title>
    <style>
        body { font-family: -apple-system, system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; }
        h1 { border-bottom: 1px solid #ccc; padding-bottom: 0.5rem; }
        .card { border: 1px solid #ddd; padding: 1.5rem; border-radius: 8px; margin-top: 1rem; }
        .input-group { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
        input { flex: 1; padding: 0.5rem; font-size: 1rem; }
        button { padding: 0.5rem 1rem; cursor: pointer; background: #000; color: #fff; border: none; }
        button.delete { background: #d9534f; margin-left: auto; }
        ul { list-style: none; padding: 0; }
        li { display: flex; align-items: center; padding: 0.5rem; border-bottom: 1px solid #eee; }
        li:last-child { border-bottom: none; }
        .msg { padding: 1rem; margin-bottom: 1rem; border-radius: 4px; display: none; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Auth Hub Admin</h1>
    
    <div id="msg" class="msg"></div>

    <div class="card">
        <h2>CORS Allowed Origins</h2>
        <p>Manage domains that are allowed to access the Auth API.</p>
        
        <div class="input-group">
            <input type="url" id="new-origin" placeholder="https://subdomain.atap.solar">
            <button id="btn-add">Add Origin</button>
        </div>

        <ul id="origin-list">
            <li>Loading...</li>
        </ul>
    </div>

    <script>
        const listEl = document.getElementById('origin-list');
        const inputEl = document.getElementById('new-origin');
        const btnAdd = document.getElementById('btn-add');
        const msgEl = document.getElementById('msg');

        function showMsg(text, type) {
            msgEl.textContent = text;
            msgEl.className = 'msg ' + type;
            msgEl.style.display = 'block';
            setTimeout(() => msgEl.style.display = 'none', 3000);
        }

        async function fetchOrigins() {
            try {
                const res = await fetch('/admin/origins');
                if (!res.ok) throw new Error('Failed to load');
                const data = await res.json();
                renderList(data.origins);
            } catch (e) {
                listEl.innerHTML = '<li style="color:red">Error loading origins</li>';
            }
        }

        function renderList(origins) {
            listEl.innerHTML = '';
            origins.forEach(origin => {
                const li = document.createElement('li');
                li.textContent = origin;
                const delBtn = document.createElement('button');
                delBtn.textContent = 'Remove';
                delBtn.className = 'delete';
                delBtn.onclick = () => deleteOrigin(origin);
                li.appendChild(delBtn);
                listEl.appendChild(li);
            });
        }

        async function addOrigin() {
            const origin = inputEl.value.trim();
            if (!origin) return;

            try {
                const res = await fetch('/admin/origins', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ origin })
                });
                if (res.ok) {
                    showMsg('Origin added', 'success');
                    inputEl.value = '';
                    fetchOrigins();
                } else {
                    const d = await res.json();
                    showMsg(d.error, 'error');
                }
            } catch (e) {
                showMsg('Network error', 'error');
            }
        }

        async function deleteOrigin(origin) {
            if (!confirm(`Remove ${origin}?`)) return;
            try {
                const res = await fetch('/admin/origins', {
                    method: 'DELETE',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ origin })
                });
                if (res.ok) {
                    showMsg('Origin removed', 'success');
                    fetchOrigins();
                } else {
                    showMsg('Failed to remove', 'error');
                }
            } catch (e) {
                showMsg('Network error', 'error');
            }
        }

        btnAdd.addEventListener('click', addOrigin);
        fetchOrigins();
    </script>
</body>
</html>
